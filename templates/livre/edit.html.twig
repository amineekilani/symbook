{% extends 'base.html.twig' %}

{% block title %}Modifier Livre
{% endblock %}

{% block body %}
<div id="content" class="content content-expanded flex-1 overflow-auto">
	<div
		class="p-8">
		<!-- Header with title and back button -->
		<div class="flex justify-between items-center mb-8">
			<div>
				<h1 class="text-2xl font-bold text-gray-800">Modifier le livre</h1>
				<p class="text-gray-600">Mettez à jour les détails du livre ci-dessous</p>
			</div>
			<a href="{{ path('app_livre_index') }}" class="flex items-center text-blue-600 hover:text-blue-800 transition-colors">
				<i class="fas fa-arrow-left mr-2"></i>
				Retour à la liste
			</a>
		</div>

		<!-- Form Card -->
		<div class="bg-white shadow rounded-lg overflow-hidden">
			<div class="p-6">
				{{ form_start(form, {'attr': {'class': 'space-y-6', 'id': 'livre-form'}}) }}

				<div
					class="grid grid-cols-1 md:grid-cols-2 gap-6">
					<!-- Titre -->
					<div>
						{{ form_label(form.titre, 'Titre du livre', {'label_attr': {'class': 'block text-sm font-medium text-gray-700 mb-1'}}) }}
						{{ form_widget(form.titre, {'attr': {'class': 'w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500'}}) }}
						<div class="text-red-500 text-sm mt-1">{{ form_errors(form.titre) }}</div>
					</div>

					<!-- ISBN -->
					<div>
						{{ form_label(form.isbn, 'ISBN', {'label_attr': {'class': 'block text-sm font-medium text-gray-700 mb-1'}}) }}
						{{ form_widget(form.isbn, {'attr': {'class': 'w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500'}}) }}
						<div class="text-red-500 text-sm mt-1">{{ form_errors(form.isbn) }}</div>
					</div>

					<!-- Image -->
					<div>
						{{ form_label(form.image, 'Image', {'label_attr': {'class': 'block text-sm font-medium text-gray-700 mb-1'}}) }}
						{{ form_widget(form.image, {'attr': {'class': 'w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500'}}) }}
						<div class="text-red-500 text-sm mt-1">{{ form_errors(form.image) }}</div>
					</div>

					<!-- Éditeur -->
					<div>
						{{ form_label(form.editeur, 'Éditeur', {'label_attr': {'class': 'block text-sm font-medium text-gray-700 mb-1'}}) }}
						{{ form_widget(form.editeur, {'attr': {'class': 'w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500'}}) }}
						<div class="text-red-500 text-sm mt-1">{{ form_errors(form.editeur) }}</div>
					</div>

					<!-- Date d'édition -->
					<div>
						{{ form_label(form.dateEdition, 'Date d\'édition', {'label_attr': {'class': 'block text-sm font-medium text-gray-700 mb-1'}}) }}
                        {{ form_widget(form.dateEdition, {'attr': {'class': 'w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500'}}) }}
                        <div class="text-red-500 text-sm mt-1">{{ form_errors(form.dateEdition) }}</div>
                    </div>
                    
                    <!-- Prix -->
                    <div>
                        {{ form_label(form.prix, 'Prix (€)', {'label_attr': {'class': 'block text-sm font-medium text-gray-700 mb-1'}}) }}
                        <div class="relative rounded-md shadow-sm">
                            {{ form_widget(form.prix, {'attr': {'class': 'w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 pl-7'}}) }}
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <span class="text-gray-500">€</span>
                            </div>
                        </div>
                        <div class="text-red-500 text-sm mt-1">{{ form_errors(form.prix) }}</div>
                    </div>
                    
                    <!-- Catégorie -->
                    <div>
                        {{ form_label(form.categorie, 'Catégorie', {'label_attr': {'class': 'block text-sm font-medium text-gray-700 mb-1'}}) }}
                        {{ form_widget(form.categorie, {'attr': {'class': 'w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500'}}) }}
                        <div class="text-red-500 text-sm mt-1">{{ form_errors(form.categorie) }}</div>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="flex justify-between mt-8">
                    <!-- Delete Button -->
                    <button type="button" onclick="confirmDelete()" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors">
                        <i class="fas fa-trash mr-2"></i> Supprimer
                    </button>
                    
                    <!-- Update Button -->
                    <button type="submit" id="submit-button" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
                        <i class="fas fa-save mr-2"></i> <span>Mettre à jour</span>
                    </button>
                </div>
                
                <!-- Loading Overlay - Hidden by default -->
                <div id="loading-overlay" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50 hidden">
                    <div class="bg-white p-5 rounded-lg flex flex-col items-center">
                        <div class="spinner-border animate-spin inline-block w-12 h-12 border-4 rounded-full border-blue-600 border-t-transparent mb-3" role="status">
                            <span class="sr-only">Chargement...</span>
                        </div>
                        <p class="text-gray-700">Mise à jour en cours...</p>
                    </div>
                </div>
                
                {{ form_end(form) }}
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full">
    <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
        <div class="mt-3 text-center">
            <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100">
                <i class="fas fa-exclamation-triangle text-red-600"></i>
            </div>
            <h3 class="text-lg leading-6 font-medium text-gray-900 mt-3">Confirmer la suppression</h3>
            <div class="mt-2 px-7 py-3">
                <p class="text-sm text-gray-500">Êtes-vous sûr de vouloir supprimer ce livre ? Cette action est irréversible.</p>
            </div>
            <div class="items-center px-4 py-3">
                <div class="flex justify-center space-x-4">
                    <button onclick="closeModal()" class="px-4 py-2 bg-gray-200 text-gray-800 text-sm font-medium rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                        Annuler
                    </button>
                    {{ include('livre/_delete_form.html.twig') }}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('livre-form');
        const loadingOverlay = document.getElementById('loading-overlay');
        const submitButton = document.getElementById('submit-button');

        // Animation au moment de la soumission du formulaire
        form.addEventListener('submit', function(event) {
            // Ne pas afficher l'animation si on clique sur le bouton supprimer
            if (event.submitter && event.submitter.type === 'button') {
                return;
            }
            
            // Afficher l'animation de chargement
            loadingOverlay.classList.remove('hidden');
            
            // Désactiver le bouton pour éviter les soumissions multiples
            submitButton.disabled = true;
            submitButton.classList.add('opacity-50', 'cursor-not-allowed');
            submitButton.querySelector('span').textContent = 'Mise à jour en cours...';
        });
    });

    function confirmDelete() {
        document.getElementById('deleteModal').classList.remove('hidden');
    }

    function closeModal() {
        document.getElementById('deleteModal').classList.add('hidden');
    }
</script>

<style>
    /* Animation for modal */
    .modal-enter {
        opacity: 0;
    }
    .modal-enter-active {
        opacity: 1;
        transition: opacity 200ms;
    }
    .modal-exit {
        opacity: 1;
    }
    .modal-exit-active {
        opacity: 0;
        transition: opacity 200ms;
    }
</style>
{% endblock %}
